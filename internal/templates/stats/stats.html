{{define "_content"}}
<div class="container-lg">
    {{$stats:=.Stats}}
    <stat-panels>
        <div class="Subhead Subhead--spacious text-center settingsDivider">
            <h2 class="Subhead-heading mt-3 mt-sm-0">
                <span>
                    {{HumanDate .Stats.Start}}
                </span>
                <span class="dash">â€“</span>
                <span>
                    {{HumanDate .Stats.End}}
                </span>
            </h2>
            <div class="Subhead-actions mt-3 mt-sm-0">
                <details class="dropdown details-overlay details-reset d-inline-block">
                    <summary role="button" class="btn">
                        <i>Period:</i>
                        <span data-menu-button>
                            {{.Stats.Period}}
                        </span>
                        {{Icon "triangle-down" 16 "ml-2 mr-n1"}}
                    </summary>
                    <div>
                        <details-menu role="menu" class="dropdown-menu select-menu-modal dropdown-menu-sw">
                            <div class="select-menu-header">
                                <div class="select-menu-title">
                                    Select time ranges
                                </div>
                            </div>
                            {{range Periods}}
                            <a role="menuitem" class="dropdown-item select-menu-item select-menu-item-text"
                                href="{{$stats.QueryPeriod .}}">
                                {{$selected := SelectedPeriod $stats.Period .}}
                                {{Icon "check" 16 "select-menu-item-icon" $selected}}
                                <span class="select-menu-item-text">
                                    {{.}}
                                </span>
                            </a>
                            {{end}}
                        </details-menu>
                    </div>
                </details>
            </div>
        </div>
        <div class="Box mb-2">
            <tab-container data-action="tab-container-change:stat-panels#change">
                {{$series:=.Stats.Series}}
                <div class="UnderlineNav px-3">
                    <ul role="tablist" class="UnderlineNav-body list-style-none">
                        {{range $series}}
                        <li>
                            <button id={{.Metric}} role="tab" {{if .Metric.Selected}} aria-selected="true" {{end}}
                                class="UnderlineNav-item px-3">
                                <span>{{.Metric.Label}}</span>
                                <span class="Counter">{{.Count}}</span>
                            </button>
                        </li>
                        {{end}}
                    </ul>
                </div>
                <div class="Box-body">
                    {{$active := index $series 0}}
                    <plot-stat data-label={{$active.Metric.Label}} data-height="240" data-ts={{JSON .Stats.Timestamps}}
                        data-values={{JSON $active.Values}} data-target="stat-panels.plot"></plot-stat>
                    {{range $series}}
                    <template data-metric={{.Metric}} data-label={{.Metric.Label}} data-prop={{.Prop}}
                        data-values={{JSON .Values}} role="tabpanel" aria-labelledby={{.Metric}}></template>
                    {{end}}
                </div>
            </tab-container>
        </div>
        <div class="d-flex">
            <div class="col-6 pr-2">
                <div class="Box">
                    <prop-panels data-targets="stat-panels.items" data-active="page" data-metric="visitors">
                        <tab-container data-action="tab-container-change:prop-panels#change">
                            <div class="UnderlineNav px-3">
                                <ul role="tablist" class="UnderlineNav-body list-style-none">
                                    <li role="presentation">
                                        <button type="button" id="pages" role="tab" aria-selected="true"
                                            class="UnderlineNav-item">Pages</button>
                                    </li>
                                    <li role="presentation">
                                        <button type="button" id="entryPages" role="tab" tabindex="-1"
                                            class="UnderlineNav-item">
                                            Entry Pages</button>
                                    </li>
                                    <li role="presentation">
                                        <button type="button" id="exitPages" role="tab" tabindex="-1"
                                            class="UnderlineNav-item">
                                            Exit Pages</button>
                                    </li>
                                </ul>
                            </div>
                            <div class="Box Box--condensed border-0">
                                <div role="tabpanel" aria-labelledby="pages" data-targets="prop-panels.panels"
                                    data-prop="page">
                                    {{template "panel" $stats.Panel "page"}}
                                </div>
                                <div role="tabpanel" data-prop="entryPage" data-targets="prop-panels.panels"
                                    aria-labelledby="entryPages" hidden>
                                    {{template "panel" $stats.Panel "entryPage"}}
                                </div>
                                <div role="tabpanel" data-prop="exitPage" data-targets="prop-panels.panels"
                                    aria-labelledby="exitPages" hidden>
                                    {{template "panel" $stats.Panel "exitPage"}}
                                </div>
                            </div>
                        </tab-container>
                    </prop-panels>

                </div>
            </div>
            <div class="col-6">
                <div class="Box">
                    <prop-panels data-targets="stat-panels.items" data-active="referrer" data-metric="visitors">
                        <tab-container data-action="tab-container-change:prop-panels#change">
                            <div class="UnderlineNav px-3">
                                <ul role="tablist" class="UnderlineNav-body list-style-none">
                                    <li role="presentation">
                                        <button type="button" id="referrers" role="tab" aria-selected="true"
                                            class="UnderlineNav-item">Referrers</button>
                                    </li>
                                    <li role="presentation">
                                        <button type="button" id="sources" role="tab" tabindex="-1"
                                            class="UnderlineNav-item">
                                            Sources</button>
                                    </li>
                                    <li role="presentation">
                                        <button type="button" id="media" role="tab" tabindex="-1"
                                            class="UnderlineNav-item">
                                            Media</button>
                                    </li>
                                    <li role="presentation">
                                        <button type="button" id="campaigns" role="tab" tabindex="-1"
                                            class="UnderlineNav-item">
                                            Campaigns</button>
                                    </li>
                                </ul>
                            </div>
                            <div class="Box Box--condensed border-0">
                                <div role="tabpanel" data-prop="referrer" data-targets="prop-panels.panels"
                                    aria-labelledby="referrers">
                                    {{template "panel" $stats.Panel "referrer"}}
                                </div>
                                <div role="tabpanel" data-prop="utmSource" data-targets="prop-panels.panels"
                                    aria-labelledby="sources" hidden>
                                    {{template "panel" $stats.Panel "utmSource"}}
                                </div>
                                <div role="tabpanel" data-prop="utmMedium" data-targets="prop-panels.panels"
                                    aria-labelledby="media" hidden>
                                    {{template "panel" $stats.Panel "utmMedium"}}
                                </div>
                                <div role="tabpanel" data-prop="utmCampaign" data-targets="prop-panels.panels"
                                    aria-labelledby="campaigns" hidden>
                                    {{template "panel" $stats.Panel "utmCampaign"}}
                                </div>
                            </div>
                        </tab-container>
                    </prop-panels>
                </div>
            </div>
        </div>
    </stat-panels>
</div>
{{end}}

{{define "panel"}}
{{$stats:=.Stats}}
{{$prop:=.Prop}}

{{range $name,$value :=.Metrics}}
<ul class="list-style-none" data-metric={{$name}} {{if ne $name "visitors" }}hidden{{end}}>
    {{range $value}}
    <li class="Box-row">
        <div class="d-flex">
            <div class="col-10">
                <a href={{$stats.QueryProp $prop $name .Key}}>

                    {{if eq $prop "referrer"}}
                    <div class="d-inline-flex flex-items-center">
                        <img src={{.Icon}} alt={{.Key}} height="16" width="16" class="mr-2">
                        <span>
                            {{.Key}}
                        </span>
                    </div>
                    {{else}}
                    {{.Key}}
                    {{end}}

                </a>
            </div>
            <div class="col-2 text-center">
                <span>{{.Value}}</span>
            </div>
        </div>
    </li>
    {{end}}
</ul>
{{end}}
{{end}}